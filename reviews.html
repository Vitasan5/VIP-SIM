<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Отзывы — Vip-simka.Крым</title>
    <link rel="stylesheet" href="css/style.css" />
</head>

<body>

    <!-- ШАПКА -->
    <header>
        <div class="logo">
            <img src="img/logo.PNG" alt="VIP SIM">
        </div>
        <nav>
            <a href="index.html">Главная</a>
            <a href="tariffs.html">Тарифы</a>
            <a href="service.html">Сервис</a>
            <a href="numbers.html">Красивые номера</a>
            <a href="apple.html">Apple</a>
            <a href="accessories.html">Аксессуары</a>
            <a href="reviews.html">Отзывы</a>
            <a href="news.html">Новости</a>
        </nav>
        <!-- Гамбургер-меню -->
        <div class="menu-toggle" id="menuToggle">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <!-- Мобильное меню -->
        <div class="mobile-menu" id="mobileMenu">
            <a href="index.html">Главная</a>
            <a href="tariffs.html">Тарифы</a>
            <a href="service.html">Сервис</a>
            <a href="numbers.html">Красивые номера</a>
            <a href="apple.html">Apple</a>
            <a href="accessories.html">Аксессуары</a>
            <a href="reviews.html">Отзывы</a>
            <a href="news.html">Новости</a>
        </div>
    </header>

    <!-- ОБЩИЙ БЕЛЫЙ КОНТЕЙНЕР -->
    <div class="page-wrapper">

        <!-- БЛОК ОТЗЫВОВ С ФОНОМ #ede6fa -->
        <section class="reviews-section">
            <h2 class="left-align">Отзывы наших клиентов</h2>

            <!-- Форма добавления (верхняя) -->
            <div class="review-form-container">
                <h3>Оставить отзыв</h3>
                <input id="review-name-top" placeholder="Ваше имя" type="text" class="review-input">
                <input id="review-city-top" placeholder="Ваш город" type="text" class="review-input">
                <textarea id="review-text-top" placeholder="Ваш отзыв" rows="3" class="review-textarea"></textarea>
                <button onclick="addReview('top')" class="btn-submit">Оставить отзыв</button>
                <div id="review-hint-top" class="review-hint"></div>
            </div>

            <!-- Список отзывов -->
            <div id="reviews-list" class="reviews-grid"></div>

            <!-- Форма добавления (нижняя) -->
            <div class="review-form-container">
                <h3>Оставить отзыв</h3>
                <input id="review-name-bottom" placeholder="Ваше имя" type="text" class="review-input">
                <input id="review-city-bottom" placeholder="Ваш город" type="text" class="review-input">
                <textarea id="review-text-bottom" placeholder="Ваш отзыв" rows="3" class="review-textarea"></textarea>
                <button onclick="addReview('bottom')" class="btn-submit">Оставить отзыв</button>
                <div id="review-hint-bottom" class="review-hint"></div>
            </div>

            <!-- Призыв -->
            <div class="review-callout">
                <p>
                    <strong>Если Вы наш клиент, мы предлагаем разместить здесь информацию о Вас или Вашем бизнесе. ЭТО
                        БЕСПЛАТНО!</strong><br>
                    Если Вас заинтересовало это предложение, сообщите нам об этом.
                </p>
            </div>
        </section>

    </div> <!-- конец page-wrapper -->

    <!-- ПОДВАЛ -->
    <footer class="site-footer">
        <div class="footer-container">
            <div class="footer-col">
                <img src="img/logo.PNG" alt="Логотип Vip-simka" style="width: 120px; margin-bottom: 15px;">
                <div class="share-container">
                    <button onclick="sharePage()" class="share-btn">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR4nyxhOq62ylFOpeWtfM9pfbieq0slJSmlUHJQz8-1Ry-f5bkXOwbzAYgVoYnuiaayV7Y&usqp=CAU"
                            alt="Поделиться" class="share-icon">
                        Поделиться с друзьями
                    </button>
                </div>
                
            </div>
            <div class="footer-col">
                <p class="footer-text">
                    <strong>Уважаемые клиенты!</strong>
                    <br><br>
                    С 1 июня 2018 г. в соответствии с поправками в Федеральном законе “О связи” 126-ФЗ, продажа и
                    активация SIM-карт возможна только по паспорту.
                    <br><br>
                    <a href="https://vip-simka.jimdofree.com/%D0%B7%D0%B0%D0%BA%D0%BE%D0%BD-%D0%BE-%D1%81%D0%B2%D1%8F%D0%B7%D0%B8/"
                        target="_blank" class="footer-link">Подробнее...</a>
                </p>
                <p class="footer-disclaimer">
                    Информационные материалы и цены, размещенные на сайте, не являются публичной офертой.
                    <br><br>
                    <strong>⚠️ Наш ресурс и наши консультанты не несут ответственности за изменения условий обслуживания
                        абонентов со стороны операторов связи или компаний, их представляющих.</strong>
                </p>
            </div>
            <div class="footer-col">
                <h4 class="footer-title">Наши контакты:</h4>
                <p class="contact-number">
                    <strong>Max / Telegram / WhatsApp</strong><br>
                    +7 991 555 666 3 (24/7)
                </p>
                <p class="footer-warning">
                    <strong>ВАЖНО!</strong><br>
                    Другие контакты не имеют отношения к нашему сайту, и мы не несем ответственности за действия третьих
                    лиц, ссылающихся на наш сайт.
                </p>
            </div>
        </div>
    </footer>

    <!-- КНОПКА "НАВЕРХ" -->
    <a href="#" id="scrollToTop" class="scroll-to-top">▲</a>

    <!-- ПЛАВАЮЩАЯ КНОПКА "СВЯЗЬ" -->
    <div class="contact-float">
        <div class="contact-wrapper">
            <div class="contact-toggle">Мы на связи</div>
            <div class="contact-menu">
                <a href="https://wa.me/79915556663" target="_blank" title="WhatsApp" class="contact-link">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp"
                        class="contact-icon">
                </a>
                <a href="https://t.me/vipsimka82" target="_blank" title="Telegram" class="contact-link">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Telegram"
                        class="contact-icon">
                </a>
                <a href="mailto:vip.simki@vk.com" title="Email" class="contact-link">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/4/4e/Gmail_Icon.png" alt="Email"
                        class="contact-icon">
                </a>
                <a href="https://instagram.com/_vipsimka" target="_blank" title="Instagram" class="contact-link">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png" alt="Instagram"
                        class="contact-icon">
                </a>
                <a href="https://facebook.com/vitalij.san.658372" target="_blank" title="Facebook" class="contact-link">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_(2019).svg"
                        alt="Facebook" class="contact-icon">
                </a>
                <a href="https://vk.com/vip.simki" target="_blank" title="VK" class="contact-link">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/2/21/VK.com-logo.svg" alt="VK"
                        class="contact-icon">
                </a>
            </div>
        </div>
    </div>

    <!-- ЕДИНЫЙ JS -->
    <script src="js/script.js"></script>

    <!-- СКРИПТ ОТЗЫВОВ -->
    <script>
        /* === Настройки === */
        var API_URL = "https://script.google.com/macros/s/AKfycbx8TgCDQNctgDzJu9Uzr62wFlhwcggEaPXEnk1_AMCgEHDiyqEnNr8BNY8ybCqSGG_XsQ/exec";
        var LOCAL_STORAGE_KEY = "user_reviews";

        /* === Утилиты === */
        function jsonpCall(paramsObj) {
            return new Promise(function (resolve, reject) {
                var cbName = "jsonp_cb_" + Date.now() + "_" + Math.floor(Math.random() * 100000);
                window[cbName] = function (data) {
                    resolve(data);
                    cleanup();
                };
                function cleanup() {
                    try { delete window[cbName]; } catch (e) { window[cbName] = undefined; }
                    if (script && script.parentNode) script.parentNode.removeChild(script);
                    if (timeout) clearTimeout(timeout);
                }
                var qs = Object.keys(paramsObj).map(function (k) {
                    return encodeURIComponent(k) + "=" + encodeURIComponent(paramsObj[k]);
                }).join("&");
                var script = document.createElement("script");
                script.src = API_URL + "?" + qs + "&callback=" + cbName;
                script.onerror = function () { reject(new Error("Network error")); cleanup(); };
                document.body.appendChild(script);
                var timeout = setTimeout(function () { reject(new Error("Timeout")); cleanup(); }, 15000);
            });
        }

        function createReviewElement(review) {
            var wrap = document.createElement('div');
            wrap.className = 'review-card';

            var p = document.createElement('p');
            p.style.margin = "0";
            p.style.fontStyle = "italic";
            p.textContent = review.text || '';

            var meta = document.createElement('div');
            meta.style.cssText = "margin-top:12px;font-weight:bold;color:#e74c3c;text-align:right;";

            var who = document.createElement('div');
            who.textContent = "— " + (review.name || "Аноним") + (review.city ? ", " + review.city : "");

            var small = document.createElement('small');
            small.style.color = "#777";
            small.textContent = review.date || '';

            meta.appendChild(who);
            meta.appendChild(small);

            wrap.appendChild(p);
            wrap.appendChild(meta);
            return wrap;
        }

        function parseRuDate(d) {
            if (!d) return new Date(0);
            var parts = d.split('.');
            if (parts.length !== 3) return new Date(0);
            return new Date(+parts[2], parts[1] - 1, +parts[0]);
        }

        function formatDate(date) {
            var day = date.getDate();
            var month = date.getMonth() + 1;
            var year = date.getFullYear();
            return (day < 10 ? '0' : '') + day + '.' + (month < 10 ? '0' : '') + month + '.' + year;
        }

        /* === Работа с отзывами === */
        async function loadReviews() {
            try {
                var serverData = await jsonpCall({ action: "list", t: Date.now() });
                var localReviews = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY) || "[]");
                var allReviews = Array.isArray(serverData) ? serverData.concat(localReviews) : localReviews;
                allReviews.sort(function (a, b) {
                    return parseRuDate(b.date) - parseRuDate(a.date);
                });

                var list = document.getElementById('reviews-list');
                list.innerHTML = '';
                allReviews.forEach(function (r) {
                    list.appendChild(createReviewElement(r));
                });

            } catch (e) {
                console.error("Ошибка загрузки:", e);
                document.getElementById('review-hint-top').textContent = "Не удалось загрузить отзывы. Попробуйте обновить страницу.";
                document.getElementById('review-hint-bottom').textContent = "Не удалось загрузить отзывы. Попробуйте обновить страницу.";
            }
        }

        async function addReview(position) {
            var name = (document.getElementById('review-name-' + position).value || '').trim() || "Аноним";
            var city = (document.getElementById('review-city-' + position).value || '').trim();
            var text = (document.getElementById('review-text-' + position).value || '').trim();

            if (!text) { alert("Введите отзыв"); return; }

            var hintTop = document.getElementById('review-hint-top');
            var hintBottom = document.getElementById('review-hint-bottom');
            hintTop.textContent = "Отправка...";
            hintBottom.textContent = "Отправка...";

            try {
                var newReview = {
                    name: name,
                    city: city,
                    text: text,
                    date: formatDate(new Date())
                };

                var localReviews = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY) || "[]");
                localReviews.unshift(newReview);
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(localReviews));

                var list = document.getElementById('reviews-list');
                var newReviewElement = createReviewElement(newReview);
                if (list.firstChild) {
                    list.insertBefore(newReviewElement, list.firstChild);
                } else {
                    list.appendChild(newReviewElement);
                }

                try {
                    var result = await jsonpCall({
                        action: "add",
                        name: name,
                        city: city,
                        text: text,
                        t: Date.now()
                    });
                    if (result && result.status === 'success') {
                        setTimeout(loadReviews, 500);
                    }
                } catch (e) {
                    console.error("Ошибка отправки на сервер:", e);
                }

                document.getElementById('review-name-top').value = '';
                document.getElementById('review-city-top').value = '';
                document.getElementById('review-text-top').value = '';
                document.getElementById('review-name-bottom').value = '';
                document.getElementById('review-city-bottom').value = '';
                document.getElementById('review-text-bottom').value = '';

                hintTop.textContent = "Спасибо! Отзыв сохранён.";
                hintBottom.textContent = "Спасибо! Отзыв сохранён.";

            } catch (e) {
                hintTop.textContent = "Ошибка сохранения. Попробуйте ещё раз.";
                hintBottom.textContent = "Ошибка сохранения. Попробуйте ещё раз.";
                console.error(e);
            }
        }

        function handleResize() {
            var cards = document.querySelectorAll('#reviews-list > div');
            cards.forEach(function (card) {
                if (window.matchMedia("(max-width: 600px)").matches) {
                    card.style.maxWidth = "100%";
                } else {
                    card.style.maxWidth = "calc(50% - 10px)";
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            loadReviews();
            window.addEventListener('resize', handleResize);
        });
    </script>
</body>

</html>
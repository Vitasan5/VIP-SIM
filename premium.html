<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ü—Ä–µ–º–∏—É–º-–∫–ª–∏–µ–Ω—Ç | VIP-SIM.RU</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      background: linear-gradient(135deg, #fdfbf6, #f5f2e6);
      color: #222;
      padding: 20px;
      min-height: 100vh;
    }
    .container {
      max-width: 600px;
      margin: 40px auto;
      background: white;
      border-radius: 20px;
      padding: 32px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
      border: 1px solid #f0e6d2;
    }
    h1 {
      text-align: center;
      margin-bottom: 24px;
      color: #b8860b;
      font-size: 28px;
      font-weight: 700;
    }
    .welcome {
      text-align: center;
      font-size: 18px;
      margin-bottom: 24px;
      color: #444;
    }
    .counter-box {
      background: #fff8e1;
      border: 1px solid #ffd54f;
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      margin: 24px 0;
      font-size: 20px;
      font-weight: 600;
      color: #5d4037;
    }
    .counter-value {
      color: #d4af37;
      font-weight: 800;
    }
    .btn {
      display: block;
      width: 100%;
      padding: 16px;
      margin: 14px 0;
      border: none;
      border-radius: 12px;
      font-size: 17px;
      font-weight: 600;
      cursor: pointer;
      text-align: center;
      text-decoration: none;
      transition: all 0.2s ease;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .btn-support {
      background: linear-gradient(135deg, #d4af37, #b8860b);
      color: white;
      font-size: 18px;
    }
    .btn-offer {
      background: #f9f7f0;
      color: #333;
      border: 1px solid #e8e4d9;
    }
    .btn-renew {
      background: #43a047;
      color: white;
    }
    .btn-logout {
      background: #e0e0e0;
      color: #555;
      margin-top: 20px;
    }
    .login-form {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .login-form input {
      padding: 14px;
      border: 1px solid #ddd;
      border-radius: 12px;
      font-size: 16px;
      outline: none;
      transition: border 0.3s;
    }
    .login-form input:focus {
      border-color: #d4af37;
    }
    .login-form button {
      background: linear-gradient(135deg, #d4af37, #b8860b);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 14px;
      font-size: 17px;
      font-weight: 600;
      cursor: pointer;
    }
    .hidden {
      display: none;
    }
    .note {
      text-align: center;
      font-size: 13px;
      color: #888;
      margin-top: 20px;
    }
    .loading {
      text-align: center;
      color: #666;
      font-size: 15px;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div class="container">
   <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ -->
<div id="loginScreen">
  <h1>‚≠ê –ü—Ä–µ–º–∏—É–º-–¥–æ—Å—Ç—É–ø</h1>
  <p style="text-align:center; margin-bottom:20px; color:#555;">
    –í–≤–µ–¥–∏—Ç–µ —Å–≤–æ—ë –∏–º—è (—Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã).<br>
    <small>–ú–∞–∫—Å–∏–º—É–º 30 —Å–∏–º–≤–æ–ª–æ–≤. –ò–º—è –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ –æ–±—Ä–∞—â–µ–Ω–∏—è—Ö.</small>
  </p>
  <div class="login-form">
    <input type="text" id="nicknameInput" placeholder="–í–∞—à–µ –∏–º—è" maxlength="30" autocomplete="off" />
    <button onclick="enterPremium()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
  </div>
  <p class="note">–ú—ã –Ω–µ —Å–æ–±–∏—Ä–∞–µ–º email, —Ç–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ –¥—Ä—É–≥–∏–µ –¥–∞–Ω–Ω—ã–µ. –¢–æ–ª—å–∫–æ –∏–º—è –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏–π.</p>
</div>

    <!-- –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç -->
    <div id="premiumScreen" class="hidden">
      <h1>‚≠ê –ü—Ä–µ–º–∏—É–º-–∫–ª–∏–µ–Ω—Ç</h1>
      <div class="welcome">–ü—Ä–∏–≤–µ—Ç, <span id="displayName">–¥—Ä—É–≥</span>!</div>
      
      <div class="counter-box">
        –û—Å—Ç–∞–ª–æ—Å—å –æ–±—Ä–∞—â–µ–Ω–∏–π: <span class="counter-value" id="counter">10</span>/10
      </div>

      <button class="btn btn-support" onclick="contactSupport()">‚≠ê –ü—Ä–µ–º–∏—É–º-–ø–æ–¥–¥–µ—Ä–∂–∫–∞</button>
      <button class="btn btn-offer">üéÅ –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Å–∫–∏–¥–∫–∏</button>
      <button class="btn btn-offer">üì¶ –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ SIM-–ø–∞–∫–µ—Ç—ã</button>
      <button class="btn btn-renew" onclick="renewAccess()">üîÅ –ü—Ä–æ–¥–ª–∏—Ç—å –¥–æ—Å—Ç—É–ø (100 ‚ÇΩ)</button>
      <button class="btn btn-logout" onclick="logout()">–í—ã–π—Ç–∏ –∏–∑ –∫–∞–±–∏–Ω–µ—Ç–∞</button>
    </div>

    <div id="loading" class="loading hidden">–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞...</div>
  </div>

  <script>
    // üîÅ URL Google Apps Script ‚Äî –ù–ï –ú–ï–ù–Ø–ô!
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz0cyNAe8POElpH2iHmC6PRMWwRzkegFTY0ZzFMQ4DoqDh6Q-vwsxO8kmkg8zYFirugUQ/exec';

    document.addEventListener('DOMContentLoaded', () => {
      const urlParams = new URLSearchParams(window.location.search);
      const tokenFromUrl = urlParams.get('token');

      if (tokenFromUrl) {
        registerNewUser(tokenFromUrl);
      } else {
        const data = getPremiumData();
        if (data) {
          loadStatusFromServer(data.token);
        } else {
          showLoginScreen();
        }
      }
    });

    function getPremiumData() {
      const raw = localStorage.getItem('premiumData');
      if (!raw) return null;
      try {
        return JSON.parse(raw);
      } catch (e) {
        return null;
      }
    }

    function savePremiumData(data) {
      localStorage.setItem('premiumData', JSON.stringify(data));
    }

    function showLoginScreen() {
      document.getElementById('loginScreen').classList.remove('hidden');
      document.getElementById('premiumScreen').classList.add('hidden');
      document.getElementById('loading').classList.add('hidden');
    }

    function showPremiumScreen(data) {
      document.getElementById('displayName').textContent = data.nickname;
      document.getElementById('counter').textContent = data.remaining;
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('premiumScreen').classList.remove('hidden');
      document.getElementById('loading').classList.add('hidden');
    }

    function enterPremium() {
      let nickname = document.getElementById('nicknameInput').value.trim();
      if (!nickname) {
        alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è.');
        return;
      }

      const validName = /^[a-zA-Z–∞-—è–ê-–Ø—ë–Å0-9 _-]+$/u;
      if (!validName.test(nickname) || nickname.length < 2 || nickname.length > 30) {
        alert('–ò–º—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å 2‚Äì30 –±—É–∫–≤/—Ü–∏—Ñ—Ä.');
        return;
      }

      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
      let id = 'VIP-';
      for (let i = 0; i < 6; i++) {
        id += chars.charAt(Math.floor(Math.random() * chars.length));
      }

      // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –≤ Google –¢–∞–±–ª–∏—Ü–µ
      fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        body: JSON.stringify({ action: 'register', client_id: id, nickname: nickname }),
        headers: { 'Content-Type': 'application/json' }
      })
      .then(res => res.json())
      .then(() => {
        const data = { token: id, nickname: nickname, remaining: 10 };
        savePremiumData(data);
        showPremiumScreen(data);
      })
      .catch(err => {
        alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.\n' + err.message);
      });
    }

    function loadStatusFromServer(clientId) {
      showLoading();
      fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        body: JSON.stringify({ action: 'get_status', client_id: clientId }),
        headers: { 'Content-Type': 'application/json' }
      })
      .then(res => res.json())
      .then(data => {
        if (data.success && !data.is_blocked) {
          const localData = getPremiumData();
          localData.remaining = data.remaining;
          savePremiumData(localData);
          showPremiumScreen(localData);
        } else {
          alert('–î–æ—Å—Ç—É–ø –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω.');
          localStorage.removeItem('premiumData');
          showLoginScreen();
        }
      })
      .catch(() => {
        const localData = getPremiumData();
        if (localData) {
          showPremiumScreen(localData);
        } else {
          showLoginScreen();
        }
      });
    }

    function contactSupport() {
      const data = getPremiumData();
      if (!data || data.remaining <= 0) {
        alert('–û–±—Ä–∞—â–µ–Ω–∏—è –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–¥–ª–∏—Ç–µ –¥–æ—Å—Ç—É–ø.');
        return;
      }

      const used = 11 - data.remaining;
      const message = `‚≠ê –û–±—Ä–∞—â–µ–Ω–∏–µ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–µ–º–∏—É–º-–∫–ª–∏–µ–Ω—Ç–æ–≤ (${used}/10).–ú—ã –æ—Ç–≤–µ—Ç–∏–º –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è. –ó–∞–¥–∞–π—Ç–µ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å:`;
      const encoded = encodeURIComponent(message);
      window.open(`https://t.me/vipsimsupport?text=${encoded}`, '_blank');

      // –£–º–µ–Ω—å—à–∞–µ–º —Å—á—ë—Ç—á–∏–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
      fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        body: JSON.stringify({ action: 'use_request', client_id: data.token }),
        headers: { 'Content-Type': 'application/json' }
      })
      .then(res => res.json())
      .then(result => {
        if (result.success) {
          data.remaining = result.remaining;
          savePremiumData(data);
          document.getElementById('counter').textContent = result.remaining;
        }
      })
      .catch(() => {
        // –õ–æ–∫–∞–ª—å–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ –∫–∞–∫ fallback
        data.remaining -= 1;
        savePremiumData(data);
        document.getElementById('counter').textContent = data.remaining;
      });
    }

    function renewAccess() {
      alert('–í –Ω–∞—Å—Ç–æ—è—â–µ–π –≤–µ—Ä—Å–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –æ–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ –ÆKassa.\n–ü–æ–∫–∞ ‚Äî –¥–µ–º–æ-—Ä–µ–∂–∏–º: –¥–æ—Å—Ç—É–ø –ø—Ä–æ–¥–ª—ë–Ω!');
      const data = getPremiumData();
      if (data) {
        data.remaining = 10;
        savePremiumData(data);
        document.getElementById('counter').textContent = 10;
      }
    }

    function logout() {
      if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –∏–∑ —ç—Ç–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞.')) {
        localStorage.removeItem('premiumData');
        showLoginScreen();
      }
    }

    function showLoading() {
      document.getElementById('loading').classList.remove('hidden');
    }

    function registerNewUser(token) {
      // –≠—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è ‚Äî –ø–æ–∫–∞ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –æ–ø–ª–∞—Ç–∞
      // –í –±—É–¥—É—â–µ–º –æ–Ω–∞ –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã
      alert('–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω!');
      enterPremium(); // –≤—Ä–µ–º–µ–Ω–Ω–æ ‚Äî –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
    }
  </script>
</body>
</html>